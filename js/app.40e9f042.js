(function(){"use strict";var e={3257:function(e,t,n){var a=n(3751),s=n(641),l=n(33);const o={class:"container"},i={class:"file-input-container"},r={for:"fileInput",class:"file-input-label"},c={for:"txtFileInput",class:"file-input-label",style:{"margin-left":"12px"}},u={class:"option-container"},d={class:"file-list"},f={class:"search-container"},h={class:"file-list-content"},p={key:0,class:"select-all-container"},g={class:"select-all-label"},v=["checked"],m={key:1},k={class:"file-checkbox"},b=["onUpdate:modelValue"],y=["onClick"],_={key:2,class:"empty-state"},L={class:"modal-content"},C={class:"modal-header"},w={class:"header-top"},F={class:"header-actions"},$={class:"statistics-note"},x={class:"statistics"},E={class:"stat-item",style:{width:"120px"}},W={class:"stat-value"},S={class:"stat-item",style:{width:"120px"}},R={class:"stat-value"},T={class:"stat-item",style:{width:"120px"}},M={class:"stat-value"},O={class:"token-calc"},j=["disabled"],A={key:0,class:"stat-value"},U={class:"token-value"},D={key:0,class:"search-nav"},K=["disabled"],I=["disabled"],X={class:"modal-body"},N={class:"chat-container"},P={class:"avatar"},V=["innerHTML"],Q={class:"button-container"},z=["disabled"],H=["textContent"];function J(e,t,n,J,Y,B){const G=(0,s.g2)("ChatDotRound"),Z=(0,s.g2)("el-icon"),q=(0,s.g2)("Upload"),ee=(0,s.g2)("el-switch"),te=(0,s.g2)("Document"),ne=(0,s.g2)("Search"),ae=(0,s.g2)("el-input"),se=(0,s.g2)("Select"),le=(0,s.g2)("ChatLineRound"),oe=(0,s.g2)("UploadFilled"),ie=(0,s.g2)("InfoFilled"),re=(0,s.g2)("el-tooltip"),ce=(0,s.g2)("Close"),ue=(0,s.g2)("Loading"),de=(0,s.g2)("User"),fe=(0,s.g2)("Download");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("h1",null,[(0,s.bF)(Z,null,{default:(0,s.k6)((()=>[(0,s.bF)(G)])),_:1}),t[12]||(t[12]=(0,s.eW)(" 某种聊天记录"))]),(0,s.Lk)("div",i,[(0,s.Lk)("label",r,[(0,s.bF)(Z,null,{default:(0,s.k6)((()=>[(0,s.bF)(q)])),_:1}),t[13]||(t[13]=(0,s.eW)(" 选择 JSON 文件 "))]),(0,s.Lk)("input",{type:"file",id:"fileInput",accept:".json",onChange:t[0]||(t[0]=(...e)=>J.handleFileChange&&J.handleFileChange(...e))},null,32),(0,s.Lk)("label",c,[(0,s.bF)(Z,null,{default:(0,s.k6)((()=>[(0,s.bF)(q)])),_:1}),t[14]||(t[14]=(0,s.eW)(" 上传聊天txt "))]),(0,s.Lk)("input",{type:"file",id:"txtFileInput",accept:".txt",multiple:"",onChange:t[1]||(t[1]=(...e)=>J.handleTxtFileChange&&J.handleTxtFileChange(...e))},null,32),(0,s.Lk)("div",u,[(0,s.bF)(ee,{modelValue:J.convertFullWidth,"onUpdate:modelValue":t[2]||(t[2]=e=>J.convertFullWidth=e),"active-text":"半角符号","inactive-text":"保持原样"},null,8,["modelValue"])])]),(0,s.Lk)("div",d,[(0,s.Lk)("h2",null,[(0,s.bF)(Z,null,{default:(0,s.k6)((()=>[(0,s.bF)(te)])),_:1}),t[15]||(t[15]=(0,s.eW)(" 聊天窗口列表"))]),(0,s.Lk)("div",f,[(0,s.bF)(ae,{modelValue:J.searchQuery,"onUpdate:modelValue":t[3]||(t[3]=e=>J.searchQuery=e),placeholder:"搜索聊天记录...","prefix-icon":e.Search,clearable:"",onInput:J.handleSearch},{prefix:(0,s.k6)((()=>[(0,s.bF)(Z,null,{default:(0,s.k6)((()=>[(0,s.bF)(ne)])),_:1})])),_:1},8,["modelValue","prefix-icon","onInput"])]),(0,s.Lk)("div",h,[J.lastOutputs.length>0?((0,s.uX)(),(0,s.CE)("div",p,[(0,s.Lk)("label",g,[(0,s.Lk)("input",{type:"checkbox",checked:J.isAllSelected,onChange:t[4]||(t[4]=(...e)=>J.toggleSelectAll&&J.toggleSelectAll(...e))},null,40,v),(0,s.bF)(Z,null,{default:(0,s.k6)((()=>[(0,s.bF)(se)])),_:1}),t[16]||(t[16]=(0,s.eW)(" 选择所有 "))])])):(0,s.Q3)("",!0),J.lastOutputs.length>0?((0,s.uX)(),(0,s.CE)("ul",m,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(J.filteredOutputs,((e,n)=>((0,s.uX)(),(0,s.CE)("li",{key:n,class:"file-item"},[(0,s.Lk)("label",k,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>J.selectedFiles[n]=e,onChange:t[5]||(t[5]=(...e)=>J.updateSelection&&J.updateSelection(...e))},null,40,b),[[a.lH,J.selectedFiles[n]]])]),(0,s.Lk)("span",{class:"file-name",onClick:t=>J.showFileContent(e)},[(0,s.bF)(Z,null,{default:(0,s.k6)((()=>[(0,s.bF)(le)])),_:1}),(0,s.eW)(" "+(0,l.v_)(e.filename),1)],8,y)])))),128))])):((0,s.uX)(),(0,s.CE)("div",_,[(0,s.bF)(Z,null,{default:(0,s.k6)((()=>[(0,s.bF)(oe)])),_:1}),t[17]||(t[17]=(0,s.eW)(" 请上传 conversation.json 文件 以查看聊天记录 "))]))])]),J.showModal?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal",onClick:t[10]||(t[10]=(0,a.D$)(((...e)=>J.closeModal&&J.closeModal(...e)),["self"]))},[(0,s.Lk)("div",L,[(0,s.Lk)("div",C,[(0,s.Lk)("div",w,[(0,s.Lk)("h3",null,[(0,s.bF)(Z,null,{default:(0,s.k6)((()=>[(0,s.bF)(te)])),_:1}),(0,s.eW)(" "+(0,l.v_)(J.currentFile?.filename),1)]),(0,s.Lk)("div",F,[(0,s.Lk)("div",$,[(0,s.bF)(re,{effect:"dark",content:"精确计算采用GPT官方分词器tokenizer-GPT 4o，不适用于Claude。考虑到聊天内容还包含文件、图片等无法被提取的内容，token计算结果仅供参考。",placement:"bottom"},{default:(0,s.k6)((()=>[(0,s.bF)(Z,null,{default:(0,s.k6)((()=>[(0,s.bF)(ie)])),_:1})])),_:1})]),(0,s.Lk)("button",{class:"close-button",onClick:t[6]||(t[6]=(...e)=>J.closeModal&&J.closeModal(...e))},[(0,s.bF)(Z,null,{default:(0,s.k6)((()=>[(0,s.bF)(ce)])),_:1})])])]),(0,s.Lk)("div",x,[(0,s.Lk)("div",E,[t[18]||(t[18]=(0,s.Lk)("span",{class:"stat-label"},"总字数：",-1)),(0,s.Lk)("span",W,(0,l.v_)(J.statistics.totalTokens),1)]),(0,s.Lk)("div",S,[t[19]||(t[19]=(0,s.Lk)("span",{class:"stat-label"},"AI回复：",-1)),(0,s.Lk)("span",R,(0,l.v_)(J.statistics.assistantCount)+"次",1)]),(0,s.Lk)("div",T,[t[20]||(t[20]=(0,s.Lk)("span",{class:"stat-label"},"用户消息：",-1)),(0,s.Lk)("span",M,(0,l.v_)(J.statistics.userCount)+"次",1)]),(0,s.Lk)("div",O,[(0,s.Lk)("button",{class:"token-button",onClick:t[7]||(t[7]=(...e)=>J.calculateExactTokens&&J.calculateExactTokens(...e)),disabled:J.isCalculating},[J.isCalculating?((0,s.uX)(),(0,s.Wv)(Z,{key:1,class:"is-loading"},{default:(0,s.k6)((()=>[(0,s.bF)(ue)])),_:1})):((0,s.uX)(),(0,s.Wv)(Z,{key:0},{default:(0,s.k6)((()=>[(0,s.bF)(ie)])),_:1})),(0,s.eW)(" "+(0,l.v_)(J.isCalculating?"计算中...":"计算精确Token"),1)],8,j),null!==J.exactTokens?((0,s.uX)(),(0,s.CE)("span",A,[(0,s.Lk)("span",U,(0,l.v_)(J.exactTokens),1),t[21]||(t[21]=(0,s.Lk)("span",{class:"token-label"},"tokens",-1))])):(0,s.Q3)("",!0)])]),J.searchKeyword&&J.matchCount>0?((0,s.uX)(),(0,s.CE)("div",D,[(0,s.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>J.gotoPrevMatch&&J.gotoPrevMatch(...e)),disabled:J.matchCount<=1},"上一个",8,K),(0,s.Lk)("span",null,(0,l.v_)(J.currentMatchIndex+1)+" / "+(0,l.v_)(J.matchCount),1),(0,s.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>J.gotoNextMatch&&J.gotoNextMatch(...e)),disabled:J.matchCount<=1},"下一个",8,I)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",X,[(0,s.Lk)("div",N,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(J.chatLines,((e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,l.C4)(["message-wrapper",J.getMessageClass(e)])},[(0,s.Lk)("div",P,[J.isLeftMessage(e)?((0,s.uX)(),(0,s.Wv)(Z,{key:0},{default:(0,s.k6)((()=>[(0,s.bF)(G)])),_:1})):((0,s.uX)(),(0,s.Wv)(Z,{key:1},{default:(0,s.k6)((()=>[(0,s.bF)(de)])),_:1}))]),(0,s.Lk)("div",{class:"message-bubble",innerHTML:J.getMessageContent(e,t)},null,8,V)],2)))),128))])])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Q,[(0,s.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>J.handleDownload&&J.handleDownload(...e)),disabled:!J.canDownload},[(0,s.bF)(Z,null,{default:(0,s.k6)((()=>[(0,s.bF)(fe)])),_:1}),t[22]||(t[22]=(0,s.eW)(" 导出选中对话 "))],8,z)]),(0,s.Lk)("div",{class:"status",textContent:(0,l.v_)(J.status)},null,8,H)])}n(4114),n(8111),n(1148),n(2489),n(7588),n(1701),n(3579);var Y=n(953),B=n(1710),G=n.n(B),Z=n(23),q=n(163),ee=n(8548),te=n(3987);let ne=null;async function ae(){return ne||(ne=te.lF),ne}async function se(e){try{ne||await ae();const t=e.split("\n");let n=0,a="",s="";for(const e of t)if(e.startsWith("【assistant】")){if(a&&s){const e=a.replace(/\[\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\]/g,"").trim(),t=ne(e);n+=t.length}s="assistant",a=e.replace(/^【.*?】\s*/,"").trim()}else if(e.startsWith("【user】")){if(a&&s){const e=a.replace(/\[\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\]/g,"").trim(),t=ne(e);n+=t.length}s="user",a=e.replace(/^【.*?】\s*/,"").trim()}else s&&(a+="\n"+e);if(a&&s){const e=a.replace(/\[\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\]/g,"").trim(),t=ne(e);n+=t.length}return console.log(`总计 Token 数量：${n}`),n}catch(t){return console.error("Token calculation failed:",t),null}}Z.xI.setOptions({breaks:!0,gfm:!0,headerIds:!1,mangle:!1,pedantic:!1,smartLists:!0,smartypants:!1});var le={name:"App",components:{ChatDotRound:ee.wUE,Upload:ee._OO,Document:ee.yoT,Select:ee.l6P,ChatLineRound:ee.Fv_,UploadFilled:ee.m8m,Close:ee.bm,Download:ee.f5X,User:ee.KJW,Search:ee.vji,InfoFilled:ee.N_H,Loading:ee.Rhj},setup(){const e=(0,Y.KR)("聊天记录将在这里显示"),t=(0,Y.KR)(""),n=(0,Y.KR)([]),a=(0,Y.KR)([]),l=(0,Y.KR)(""),o=(0,Y.KR)([]),i=(0,s.EW)((()=>a.value.some((e=>e)))),r=(0,Y.KR)(!1),c=(0,Y.KR)(null),u=(0,Y.KR)(!1),d=(0,Y.KR)(null),f=(0,Y.KR)(""),h=(0,Y.KR)(0),p=(0,Y.KR)(0),g=(0,Y.KR)([]),v=(0,Y.KR)(!1),m=(0,s.EW)((()=>n.value.length>0&&a.value.every((e=>e))));function k(e){const t=e.target.checked;a.value=n.value.map((()=>t))}function b(){a.value=[...a.value]}function y(e){return e.replace(/[\\/*?:"<>|]/g,"")}function _(e){const t=[];if(!e||"object"!==typeof e)return t;for(const a in e)try{const n=e[a];if(!n||!n.message)continue;const s=n.message,l=s.author?.role||"unknown";if(!["user","assistant"].includes(l))continue;const o=s.content||{};if(o.parts&&o.parts.length){const e=o.parts.join(" ").replace(/^"|"$/g,"").trim();if(e){const n=s.create_time?new Date(1e3*s.create_time):null,a=n?n.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-"):"";t.push(`【${l}】${a?`[${a}]`:""} ${e}`)}}else if("user"===l){const e=s.metadata||{},n=e.user_context_message_data||{},a=(n.about_model_message||"").trim(),l=(n.about_user_message||"").trim();let o=!1;a&&(t.push(`【model_message】 ${a}`),o=!0),l&&(t.push(`【user_message】 ${l}`),o=!0),o&&t.push("-".repeat(80))}}catch(n){console.log(`处理 mapping 内随机键 ${a} 时出错：${n}`)}return t}function L(e){const t=[],n=[];if(!e||"object"!==typeof e)return t;for(const s in e){const t=e[s];if(t&&t.message){const e=t.message;if(e.fragments&&Array.isArray(e.fragments)){for(const a of e.fragments)if(a.content&&a.type){let s="";if("RESPONSE"===a.type)s="assistant";else{if("REQUEST"!==a.type)continue;s="user"}n.push({id:t.id,parent:t.parent,content:a.content,role:s,inserted_at:e.inserted_at})}}else e.content&&"string"===typeof e.content&&n.push({id:t.id,parent:t.parent,content:e.content,inserted_at:e.inserted_at})}}n.sort(((e,t)=>e.inserted_at&&t.inserted_at?new Date(e.inserted_at)-new Date(t.inserted_at):0));const a={};n.forEach((e=>{a[e.id]=e}));for(const s of n){let e=s.role||"",n="";if(!e){if("root"===s.parent)e="user";else{const t=a[s.parent];e=t?"user"===t.role?"assistant":"user":"assistant"}s.role=e}if(s.inserted_at&&(n=C(s.inserted_at)),s.content&&"string"===typeof s.content){const a=s.content.trim();if(a){const s=`【${e}】${n?` [${n}]`:""} ${a}`;t.push(s)}}}return t}function C(e){try{let t;if("number"===typeof e)t=new Date(1e3*e);else{if("string"!==typeof e)return"";t=new Date(e)}if(isNaN(t.getTime()))return"";const n=new Date(t.getTime()+6e4*t.getTimezoneOffset()),a=new Date(n.getTime()+288e5),s=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),o=String(a.getDate()).padStart(2,"0"),i=String(a.getHours()).padStart(2,"0"),r=String(a.getMinutes()).padStart(2,"0"),c=String(a.getSeconds()).padStart(2,"0");return`${s}-${l}-${o} ${i}:${r}:${c}`}catch(t){return console.error("时间戳转换错误:",t),""}}function w(e){const t=[];if(Array.isArray(e)){const n={};for(const a of e)if(void 0!==a.name&&void 0!==a.chat_messages){const e=a.name||"Undefined",s=a.chat_messages||[];if(!s.length)continue;const l=[];for(const t of s){const e=t.sender,n=t.text,a=t.created_at?C(t.created_at):"";if(e&&n){const t="human"===e?"user":"assistant";l.push(`【${t}】${a?` [${a}]`:""} ${n}`)}}if(l.length){const a=y(e),s=(n[a]||0)+1;n[a]=s;const o=s>1?`${a}_${s}.txt`:`${a}.txt`;t.push({filename:o,content:l.join("\n")})}}else if(void 0!==a.title&&void 0!==a.mapping){const e=a.mapping;if(!e||"object"!==typeof e)continue;let s=!1;for(const t in e)if(e[t]&&e[t].message){const n=e[t].message;if(n.fragments&&Array.isArray(n.fragments)&&n.fragments.some((e=>e.content&&e.type&&("RESPONSE"===e.type||"REQUEST"===e.type)))){s=!0;break}if(n.content&&"string"===typeof n.content&&void 0!==e[t].id){s=!0;break}}if(s){const s=a.title||"unknown",l=L(e);if(!l.length)continue;const o=y(s)||"unknown",i=(n[o]||0)+1;n[o]=i;const r=i>1?`${o}_${i}.txt`:`${o}.txt`;t.push({filename:r,content:l.join("\n")})}else{const s=a.title||"unknown",l=_(e);if(!l.length)continue;const o=y(s)||"unknown",i=(n[o]||0)+1;n[o]=i;const r=i>1?`${o}_${i}.txt`:`${o}.txt`;t.push({filename:r,content:l.join("\n")})}}if(0===t.length)throw new Error("未找到有效的对话内容");return t}if("object"!==typeof e||Array.isArray(e))throw new Error("不支持的 JSON 格式");for(const n in e){const a=e[n];if(!a||"object"!==typeof a)continue;const s=a.mapping;if(!s)continue;const l=_(s);if(l.length){const e=y(n)||"unknown",a=l.join("\n");t.push({filename:e+".txt",content:a})}}if(0===t.length)throw new Error("未找到有效的对话内容");return t}function F(e){c.value=e,r.value=!0,d.value=null}function $(){r.value=!1,c.value=null}function x(){if(!l.value.trim())return o.value=n.value,void(f.value="");const e=l.value.toLowerCase();o.value=n.value.filter((t=>!!t.filename.toLowerCase().includes(e)||!!t.content.toLowerCase().includes(e))),f.value=l.value.trim()}async function E(e){const s=e.target.files[0];if(!s)return;t.value="正在解析文件...";const l=new FileReader;l.onload=function(e){try{const s=JSON.parse(e.target.result),l=w(s);if(n.value=l,o.value=l,a.value=l.map((()=>!1)),0===l.length)return void q.nk.error("解析完成，但未找到对话内容");t.value=`解析完成，找到 ${l.length} 个会话`}catch(s){q.nk.error(s.message||"解析失败"),t.value="解析失败"}},l.readAsText(s,"utf-8")}async function W(){if(a.value.some((e=>e)))try{t.value="正在准备导出...";const e=n.value.filter(((e,t)=>a.value[t]));if(1===e.length){const n=new Blob([e[0].content],{type:"text/plain"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=e[0].filename,s.click(),URL.revokeObjectURL(a),t.value="导出完成"}else{t.value="正在打包文件，请稍候...";const n=new(G());e.forEach((e=>{n.file(e.filename,e.content)}));const a=await n.generateAsync({type:"blob"}),s=URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download="chatgpt_dialogues.zip",l.click(),URL.revokeObjectURL(s),t.value=`已导出 ${e.length} 个文件到 chatgpt_dialogues.zip`}}catch(e){t.value="导出失败"}}const S=(0,s.EW)((()=>{if(!c.value?.content)return[];const e=/【(model_message|user_message|assistant|user)】/,t=c.value.content.split("\n"),n=[];let a="",s="";for(const l of t){const t=l.match(e);t?(a&&n.push(`【${s}】${a}`),s=t[1],a=l.replace(e,"").trim()):s&&(a+="\n"+l)}return a&&n.push(`【${s}】${a}`),n.filter((e=>{const t=e.replace(/^【.*?】\s*/,"").trim();return t.length>0}))}));function R(e){return e.startsWith("【assistant】")||e.startsWith("【model_message】")?"message-left":"message-right"}function T(e){return e.startsWith("【assistant】")||e.startsWith("【model_message】")}function M(e){return v.value?e.replace(/[\u2018\u2019\u201C\u201D]/g,(e=>{switch(e){case"‘":case"’":return"'";case"“":case"”":return'"';default:return e}})):e}function O(e,t){let n=e.replace(/^【.*?】\s*/,"").trim();n=n.replace(/\[\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\]\s*/,"");const a=e.startsWith("【user_message】")?n.replace(/-{20,}/g,""):n;let s=(0,Z.xI)(M(a),{breaks:!0});const l=e.match(/\[(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})\]/);if(l&&(s=`<div class="message-timestamp">${l[1]}</div>${s}`),f.value){const e=new RegExp(f.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");let n=0;s=s.replace(e,(e=>{const a=`search-match-${t}-${n}`;return n++,`<mark data-match-idx="${n-1}" id="${a}">${e}</mark>`}))}return s.replace(/\s+$/,"").replace(/\n$/,"")}const j=(0,s.EW)((()=>{if(!c.value?.content)return{totalTokens:0,assistantCount:0,userCount:0};const e=c.value.content.split("\n");let t=0,n=0,a=0,s="",l="";const o=e=>{e=e.replace(/\[\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\]\s*/g,""),e=e.replace(/https?:\/\/[^\s]+/g,"");let t=0;const n=e.match(/[a-zA-Z]+|[0-9]+|[\u4e00-\u9fa5]|[^\s]/g)||[];for(const a of n)/[a-zA-Z]/.test(a)?t+=Math.ceil(a.length/4):/[0-9]/.test(a)?t+=Math.ceil(a.length/2):/[\u4e00-\u9fa5]/.test(a)?t+=1:(/[\s.,!?;:'"()\-–—…]/.test(a),t+=.5);return Math.round(t)};for(const i of e)i.startsWith("【assistant】")||i.startsWith("【model_message】")?(s&&l&&(t+=o(s),"assistant"===l?n++:a++),l="assistant",s=i.replace(/^【.*?】\s*/,"").trim()):i.startsWith("【user】")||i.startsWith("【user_message】")?(s&&l&&(t+=o(s),"assistant"===l?n++:a++),l="user",s=i.replace(/^【.*?】\s*/,"").trim()):l&&(s+="\n"+i);return s&&l&&(t+=o(s),"assistant"===l?n++:a++),{totalTokens:t,assistantCount:n,userCount:a}}));async function A(){if(c.value?.content){u.value=!0,d.value=null;try{const e=S.value,t=e.join("\n"),n=await se(t);null!==n&&(d.value=n)}catch(e){console.error("Token calculation failed:",e),q.nk.error("计算token失败，请稍后重试")}finally{u.value=!1}}}async function U(e){const s=e.target.files;if(!s||!s.length)return;let l=[];for(const t of s)try{const e=await t.text();if(!e.trim()){q.nk.error(`${t.name} 文件内容为空`);continue}const n=e.split("\n"),a=n.some((e=>{const t=e.trim();return t&&!t.startsWith("-".repeat(20))}));if(!a){q.nk.error(`${t.name} 未包含有效的对话内容`);continue}const s=n.some((e=>{const t=e.trim();return t&&(t.startsWith("【assistant】")||t.startsWith("【user】")||t.startsWith("【model_message】")||t.startsWith("【user_message】"))}));if(!s){q.nk.error(`${t.name} 未包含有效的AI或用户对话内容`);continue}l.push({filename:t.name,content:e})}catch(i){q.nk.error(`读取${t.name}失败`)}l.length&&(n.value=[...n.value,...l],o.value=n.value,a.value=n.value.map((()=>!1)),t.value=`已导入 ${l.length} 个txt文件`),e.target.value=""}function D(){(0,s.dY)((()=>{g.value=Array.from(document.querySelectorAll(".modal-body mark[data-match-idx]")),h.value=g.value.length,h.value>0&&K(p.value)}))}function K(e){g.value[e]&&(g.value[e].scrollIntoView({behavior:"smooth",block:"center"}),g.value.forEach(((t,n)=>{t.classList.toggle("active-match",n===e)})))}function I(){h.value<=1||(p.value=(p.value-1+h.value)%h.value,K(p.value))}function X(){h.value<=1||(p.value=(p.value+1)%h.value,K(p.value))}return(0,s.sV)((async()=>{await(0,s.dY)(),setTimeout((async()=>{try{await ae()}catch(e){console.error("Failed to preload encoder:",e),q.nk.error("加载失败，请刷新页面重试")}}),100)})),(0,s.wB)([r,f,c],(()=>{r.value&&(p.value=0,D())})),{outputContent:e,status:t,canDownload:i,lastOutputs:n,selectedFiles:a,isAllSelected:m,showModal:r,currentFile:c,searchQuery:l,filteredOutputs:o,statistics:j,handleFileChange:E,handleDownload:W,showFileContent:F,closeModal:$,toggleSelectAll:k,updateSelection:b,chatLines:S,getMessageClass:R,isLeftMessage:T,getMessageContent:O,handleSearch:x,isCalculating:u,exactTokens:d,calculateExactTokens:A,handleTxtFileChange:U,searchKeyword:f,matchCount:h,currentMatchIndex:p,gotoPrevMatch:I,gotoNextMatch:X,convertFullWidth:v}}},oe=n(6262);const ie=(0,oe.A)(le,[["render",J]]);var re=ie,ce=n(2220);n(4188);const ue=(0,a.Ef)(re);ue.use(ce.A),ue.mount("#app")}},t={};function n(a){var s=t[a];if(void 0!==s)return s.exports;var l=t[a]={exports:{}};return e[a].call(l.exports,l,l.exports,n),l.exports}n.m=e,function(){var e=[];n.O=function(t,a,s,l){if(!a){var o=1/0;for(u=0;u<e.length;u++){a=e[u][0],s=e[u][1],l=e[u][2];for(var i=!0,r=0;r<a.length;r++)(!1&l||o>=l)&&Object.keys(n.O).every((function(e){return n.O[e](a[r])}))?a.splice(r--,1):(i=!1,l<o&&(o=l));if(i){e.splice(u--,1);var c=s();void 0!==c&&(t=c)}}return t}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[a,s,l]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var s,l,o=a[0],i=a[1],r=a[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(s in i)n.o(i,s)&&(n.m[s]=i[s]);if(r)var u=r(n)}for(t&&t(a);c<o.length;c++)l=o[c],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(u)},a=self["webpackChunkchatlog_parser"]=self["webpackChunkchatlog_parser"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[504],(function(){return n(3257)}));a=n.O(a)})();
//# sourceMappingURL=app.40e9f042.js.map