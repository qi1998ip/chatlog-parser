(function(){"use strict";var e={2706:function(e,t,n){var a=n(3751),s=n(641),l=n(33);const o={class:"container"},c={class:"file-input-container"},i={for:"fileInput",class:"file-input-label"},r={for:"txtFileInput",class:"file-input-label",style:{"margin-left":"12px"}},u={class:"file-list"},d={class:"search-container"},f={class:"file-list-content"},g={key:0,class:"select-all-container"},p={class:"select-all-label"},h=["checked"],v={key:1},m={class:"file-checkbox"},k=["onUpdate:modelValue"],b=["onClick"],y={key:2,class:"empty-state"},_={class:"modal-content"},L={class:"modal-header"},C={class:"header-top"},$={class:"header-actions"},w={class:"statistics-note"},F={class:"statistics"},x={class:"stat-item",style:{width:"120px"}},S={class:"stat-value"},M={class:"stat-item",style:{width:"120px"}},E={class:"stat-value"},W={class:"stat-item",style:{width:"120px"}},R={class:"stat-value"},O={class:"export-current"},T=["title"],A=["title"],j=["disabled"],U={key:0,class:"token-calc"},K=["disabled"],D={key:0,class:"stat-value"},I={class:"token-value"},X={key:0,class:"search-nav"},Q=["disabled"],N=["disabled"],P={class:"modal-body"},V={class:"chat-container"},z={key:0,class:"message-checkbox"},H=["onUpdate:modelValue","id"],J=["for"],B={class:"avatar"},Y=["innerHTML"],G={class:"button-container"},Z=["disabled"],q=["textContent"];function ee(e,t,n,ee,te,ne){const ae=(0,s.g2)("ChatDotRound"),se=(0,s.g2)("el-icon"),le=(0,s.g2)("Upload"),oe=(0,s.g2)("Document"),ce=(0,s.g2)("Search"),ie=(0,s.g2)("el-input"),re=(0,s.g2)("Select"),ue=(0,s.g2)("ChatLineRound"),de=(0,s.g2)("UploadFilled"),fe=(0,s.g2)("InfoFilled"),ge=(0,s.g2)("el-tooltip"),pe=(0,s.g2)("Close"),he=(0,s.g2)("Download"),ve=(0,s.g2)("Loading"),me=(0,s.g2)("User");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("h1",null,[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(ae)])),_:1}),t[14]||(t[14]=(0,s.eW)(" 某种聊天记录"))]),(0,s.Lk)("div",c,[(0,s.Lk)("label",i,[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(le)])),_:1}),t[15]||(t[15]=(0,s.eW)(" 选择 JSON 文件 "))]),(0,s.Lk)("input",{type:"file",id:"fileInput",accept:".json",onChange:t[0]||(t[0]=(...e)=>ee.handleFileChange&&ee.handleFileChange(...e))},null,32),(0,s.Lk)("label",r,[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(le)])),_:1}),t[16]||(t[16]=(0,s.eW)(" 上传聊天txt "))]),(0,s.Lk)("input",{type:"file",id:"txtFileInput",accept:".txt",multiple:"",onChange:t[1]||(t[1]=(...e)=>ee.handleTxtFileChange&&ee.handleTxtFileChange(...e))},null,32)]),(0,s.Lk)("div",u,[(0,s.Lk)("h2",null,[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(oe)])),_:1}),t[17]||(t[17]=(0,s.eW)(" 聊天窗口列表"))]),(0,s.Lk)("div",d,[(0,s.bF)(ie,{modelValue:ee.searchQuery,"onUpdate:modelValue":t[2]||(t[2]=e=>ee.searchQuery=e),placeholder:"搜索聊天记录...","prefix-icon":e.Search,clearable:"",onInput:ee.handleSearch},{prefix:(0,s.k6)((()=>[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(ce)])),_:1})])),_:1},8,["modelValue","prefix-icon","onInput"])]),(0,s.Lk)("div",f,[ee.lastOutputs.length>0?((0,s.uX)(),(0,s.CE)("div",g,[(0,s.Lk)("label",p,[(0,s.Lk)("input",{type:"checkbox",checked:ee.isAllSelected,onChange:t[3]||(t[3]=(...e)=>ee.toggleSelectAll&&ee.toggleSelectAll(...e))},null,40,h),(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(re)])),_:1}),t[18]||(t[18]=(0,s.eW)(" 选择所有 "))])])):(0,s.Q3)("",!0),ee.lastOutputs.length>0?((0,s.uX)(),(0,s.CE)("ul",v,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ee.filteredOutputs,((e,n)=>((0,s.uX)(),(0,s.CE)("li",{key:n,class:"file-item"},[(0,s.Lk)("label",m,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>ee.selectedFiles[n]=e,onChange:t[4]||(t[4]=(...e)=>ee.updateSelection&&ee.updateSelection(...e))},null,40,k),[[a.lH,ee.selectedFiles[n]]])]),(0,s.Lk)("span",{class:"file-name",onClick:t=>ee.showFileContent(e)},[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(ue)])),_:1}),(0,s.eW)(" "+(0,l.v_)(e.filename),1)],8,b)])))),128))])):((0,s.uX)(),(0,s.CE)("div",y,[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(de)])),_:1}),t[19]||(t[19]=(0,s.eW)(" 请上传 conversation.json 文件 以查看聊天记录 "))]))])]),ee.showModal?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal",onClick:t[12]||(t[12]=(0,a.D$)(((...e)=>ee.closeModal&&ee.closeModal(...e)),["self"]))},[(0,s.Lk)("div",_,[(0,s.Lk)("div",L,[(0,s.Lk)("div",C,[(0,s.Lk)("h3",null,[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(oe)])),_:1}),(0,s.eW)(" "+(0,l.v_)(ee.currentFile?.filename),1)]),(0,s.Lk)("div",$,[(0,s.Lk)("div",w,[(0,s.bF)(ge,{effect:"dark",content:"精确计算采用GPT官方分词器tokenizer-GPT 4o，不适用于Claude。考虑到聊天内容还包含文件、图片等无法被提取的内容，token计算结果仅供参考。",placement:"bottom"},{default:(0,s.k6)((()=>[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(fe)])),_:1})])),_:1})]),(0,s.Lk)("button",{class:"close-button",onClick:t[5]||(t[5]=(...e)=>ee.closeModal&&ee.closeModal(...e))},[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(pe)])),_:1})])])]),(0,s.Lk)("div",F,[(0,s.Lk)("div",x,[t[20]||(t[20]=(0,s.Lk)("span",{class:"stat-label"},"总字数：",-1)),(0,s.Lk)("span",S,(0,l.v_)(ee.statistics.totalTokens),1)]),(0,s.Lk)("div",M,[t[21]||(t[21]=(0,s.Lk)("span",{class:"stat-label"},"AI回复：",-1)),(0,s.Lk)("span",E,(0,l.v_)(ee.statistics.assistantCount)+"次",1)]),(0,s.Lk)("div",W,[t[22]||(t[22]=(0,s.Lk)("span",{class:"stat-label"},"用户消息：",-1)),(0,s.Lk)("span",R,(0,l.v_)(ee.statistics.userCount)+"次",1)]),(0,s.Lk)("div",O,[(0,s.Lk)("button",{class:"mode-toggle-button",onClick:t[6]||(t[6]=(...e)=>ee.toggleSelectMode&&ee.toggleSelectMode(...e)),title:ee.isSelectMode?"退出选择模式":"进入选择模式"},[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(re)])),_:1}),(0,s.eW)(" "+(0,l.v_)(ee.isSelectMode?"退出选择":"选择消息"),1)],8,T),ee.isSelectMode?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.Lk)("button",{class:"select-all-button",onClick:t[7]||(t[7]=(...e)=>ee.toggleSelectAllMessages&&ee.toggleSelectAllMessages(...e)),title:ee.isAllMessagesSelected?"取消全选":"全选消息"},[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(re)])),_:1}),(0,s.eW)(" "+(0,l.v_)(ee.isAllMessagesSelected?"取消全选":"全选"),1)],8,A),(0,s.Lk)("button",{class:"export-button",onClick:t[8]||(t[8]=(...e)=>ee.exportSelectedMessages&&ee.exportSelectedMessages(...e)),disabled:!ee.hasSelectedMessages,title:"导出选中的消息"},[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(he)])),_:1}),(0,s.eW)(" 导出选中 ("+(0,l.v_)(ee.selectedMessagesCount)+") ",1)],8,j)],64)):(0,s.Q3)("",!0)]),ee.isSelectMode?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",U,[(0,s.Lk)("button",{class:"token-button",onClick:t[9]||(t[9]=(...e)=>ee.calculateExactTokens&&ee.calculateExactTokens(...e)),disabled:ee.isCalculating},[ee.isCalculating?((0,s.uX)(),(0,s.Wv)(se,{key:1,class:"is-loading"},{default:(0,s.k6)((()=>[(0,s.bF)(ve)])),_:1})):((0,s.uX)(),(0,s.Wv)(se,{key:0},{default:(0,s.k6)((()=>[(0,s.bF)(fe)])),_:1})),(0,s.eW)(" "+(0,l.v_)(ee.isCalculating?"计算中...":"计算精确Token"),1)],8,K),null!==ee.exactTokens?((0,s.uX)(),(0,s.CE)("span",D,[(0,s.Lk)("span",I,(0,l.v_)(ee.exactTokens),1),t[23]||(t[23]=(0,s.Lk)("span",{class:"token-label"},"tokens",-1))])):(0,s.Q3)("",!0)]))]),ee.searchKeyword&&ee.matchCount>0?((0,s.uX)(),(0,s.CE)("div",X,[(0,s.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>ee.gotoPrevMatch&&ee.gotoPrevMatch(...e)),disabled:ee.matchCount<=1},"上一个",8,Q),(0,s.Lk)("span",null,(0,l.v_)(ee.currentMatchIndex+1)+" / "+(0,l.v_)(ee.matchCount),1),(0,s.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>ee.gotoNextMatch&&ee.gotoNextMatch(...e)),disabled:ee.matchCount<=1},"下一个",8,N)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",P,[(0,s.Lk)("div",V,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ee.chatLines,((e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,l.C4)(["message-container",{selected:ee.isSelectMode&&ee.selectedMessages[t]}])},[ee.isSelectMode?((0,s.uX)(),(0,s.CE)("div",z,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>ee.selectedMessages[t]=e,id:`msg-${t}`},null,8,H),[[a.lH,ee.selectedMessages[t]]]),(0,s.Lk)("label",{for:`msg-${t}`},null,8,J)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,l.C4)(["message-wrapper",ee.getMessageClass(e)])},[(0,s.Lk)("div",B,[ee.isLeftMessage(e)?((0,s.uX)(),(0,s.Wv)(se,{key:0},{default:(0,s.k6)((()=>[(0,s.bF)(ae)])),_:1})):((0,s.uX)(),(0,s.Wv)(se,{key:1},{default:(0,s.k6)((()=>[(0,s.bF)(me)])),_:1}))]),(0,s.Lk)("div",{class:"message-bubble",innerHTML:ee.getMessageContent(e,t)},null,8,Y)],2)],2)))),128))])])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",G,[(0,s.Lk)("button",{onClick:t[13]||(t[13]=(...e)=>ee.handleDownload&&ee.handleDownload(...e)),disabled:!ee.canDownload},[(0,s.bF)(se,null,{default:(0,s.k6)((()=>[(0,s.bF)(he)])),_:1}),t[24]||(t[24]=(0,s.eW)(" 导出选中对话 "))],8,Z)]),(0,s.Lk)("div",{class:"status",textContent:(0,l.v_)(ee.status)},null,8,q)])}n(4114),n(8111),n(1148),n(2489),n(7588),n(1701),n(3579);var te=n(953),ne=n(1710),ae=n.n(ne),se=n(23),le=n(163),oe=n(8548),ce=n(3987);let ie=null;async function re(){return ie||(ie=ce.lF),ie}async function ue(e){try{ie||await re();const t=e.split("\n");let n=0,a="",s="";for(const e of t)if(e.startsWith("【assistant】")){if(a&&s){const e=a.replace(/\[\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\]/g,"").trim(),t=ie(e);n+=t.length}s="assistant",a=e.replace(/^【.*?】\s*/,"").trim()}else if(e.startsWith("【user】")){if(a&&s){const e=a.replace(/\[\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\]/g,"").trim(),t=ie(e);n+=t.length}s="user",a=e.replace(/^【.*?】\s*/,"").trim()}else s&&(a+="\n"+e);if(a&&s){const e=a.replace(/\[\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\]/g,"").trim(),t=ie(e);n+=t.length}return console.log(`总计 Token 数量：${n}`),n}catch(t){return console.error("Token calculation failed:",t),null}}se.xI.setOptions({breaks:!0,gfm:!0,headerIds:!1,mangle:!1,pedantic:!1,smartLists:!0,smartypants:!1});var de={name:"App",components:{ChatDotRound:oe.wUE,Upload:oe._OO,Document:oe.yoT,Select:oe.l6P,ChatLineRound:oe.Fv_,UploadFilled:oe.m8m,Close:oe.bm,Download:oe.f5X,User:oe.KJW,Search:oe.vji,InfoFilled:oe.N_H,Loading:oe.Rhj},setup(){const e=(0,te.KR)("聊天记录将在这里显示"),t=(0,te.KR)(""),n=(0,te.KR)([]),a=(0,te.KR)([]),l=(0,te.KR)(""),o=(0,te.KR)([]),c=(0,s.EW)((()=>a.value.some((e=>e)))),i=(0,te.KR)(!1),r=(0,te.KR)(null),u=(0,te.KR)(!1),d=(0,te.KR)(null),f=(0,te.KR)(""),g=(0,te.KR)(0),p=(0,te.KR)(0),h=(0,te.KR)([]),v=(0,te.KR)([]),m=(0,te.KR)(!1),k=(0,s.EW)((()=>n.value.length>0&&a.value.every((e=>e)))),b=(0,s.EW)((()=>T.value.length>0&&v.value.length===T.value.length&&v.value.every((e=>e)))),y=(0,s.EW)((()=>v.value.filter((e=>e)).length)),_=(0,s.EW)((()=>y.value>0));function L(e){const t=e.target.checked;a.value=n.value.map((()=>t))}function C(){a.value=[...a.value]}function $(e){return e.replace(/[\\/*?:"<>|]/g,"")}function w(e){const t=[];if(!e||"object"!==typeof e)return t;for(const a in e)try{const n=e[a];if(!n||!n.message)continue;const s=n.message,l=s.author?.role||"unknown";if(!["user","assistant"].includes(l))continue;const o=s.content||{};let c="";if(s.create_time?c=x(s.create_time):s.created_at&&(c=x(s.created_at)),o.parts&&o.parts.length){const e=o.parts.join(" ").replace(/^"|"$/g,"").trim();e&&t.push(`【${l}】${c?` [${c}]`:""} ${e}`)}else if("user"===l){const e=s.metadata||{},n=e.user_context_message_data||{},a=(n.about_model_message||"").trim(),l=(n.about_user_message||"").trim();let o=!1;a&&(t.push(`【model_message】${c?` [${c}]`:""} ${a}`),o=!0),l&&(t.push(`【user_message】${c?` [${c}]`:""} ${l}`),o=!0),o&&t.push("-".repeat(80))}}catch(n){console.log(`处理 mapping 内随机键 ${a} 时出错：${n}`)}return t}function F(e){const t=[],n=[];if(!e||"object"!==typeof e)return t;for(const s in e){const t=e[s];if(t&&t.message){const e=t.message;if(e.fragments&&Array.isArray(e.fragments)){for(const a of e.fragments)if(a.content&&a.type){let s="";if("RESPONSE"===a.type)s="assistant";else{if("REQUEST"!==a.type)continue;s="user"}n.push({id:t.id,parent:t.parent,content:a.content,role:s,inserted_at:e.inserted_at})}}else e.content&&"string"===typeof e.content&&n.push({id:t.id,parent:t.parent,content:e.content,inserted_at:e.inserted_at})}}n.sort(((e,t)=>e.inserted_at&&t.inserted_at?new Date(e.inserted_at)-new Date(t.inserted_at):0));const a={};n.forEach((e=>{a[e.id]=e}));for(const s of n){let e=s.role||"",n="";if(!e){if("root"===s.parent)e="user";else{const t=a[s.parent];e=t?"user"===t.role?"assistant":"user":"assistant"}s.role=e}if(s.inserted_at&&(n=x(s.inserted_at)),s.content&&"string"===typeof s.content){const a=s.content.trim();if(a){const s=`【${e}】${n?` [${n}]`:""} ${a}`;t.push(s)}}}return t}function x(e){try{let t;if("number"===typeof e)t=new Date(1e3*e);else{if("string"!==typeof e)return"";t=new Date(e)}if(isNaN(t.getTime()))return"";const n=new Date(t.getTime()+6e4*t.getTimezoneOffset()),a=new Date(n.getTime()+288e5),s=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),o=String(a.getDate()).padStart(2,"0"),c=String(a.getHours()).padStart(2,"0"),i=String(a.getMinutes()).padStart(2,"0"),r=String(a.getSeconds()).padStart(2,"0");return`${s}-${l}-${o} ${c}:${i}:${r}`}catch(t){return console.error("时间戳转换错误:",t),""}}function S(e){const t=[];if(Array.isArray(e)){const n={};for(const a of e)if(void 0!==a.name&&void 0!==a.chat_messages){const e=a.name||"Undefined",s=a.chat_messages||[];if(!s.length)continue;const l=[];for(const t of s){const e=t.sender,n=t.text,a=t.created_at?x(t.created_at):"";if(e&&n){const t="human"===e?"user":"assistant";l.push(`【${t}】${a?` [${a}]`:""} ${n}`)}}if(l.length){const a=$(e),s=(n[a]||0)+1;n[a]=s;const o=s>1?`${a}_${s}.txt`:`${a}.txt`;t.push({filename:o,content:l.join("\n")})}}else if(void 0!==a.title&&void 0!==a.mapping){const e=a.mapping;if(!e||"object"!==typeof e)continue;let s=!1;for(const t in e)if(e[t]&&e[t].message){const n=e[t].message;if(n.fragments&&Array.isArray(n.fragments)&&n.fragments.some((e=>e.content&&e.type&&("RESPONSE"===e.type||"REQUEST"===e.type)))){s=!0;break}if(n.content&&"string"===typeof n.content&&void 0!==e[t].id){s=!0;break}}if(s){const s=a.title||"unknown",l=F(e);if(!l.length)continue;const o=$(s)||"unknown",c=(n[o]||0)+1;n[o]=c;const i=c>1?`${o}_${c}.txt`:`${o}.txt`;t.push({filename:i,content:l.join("\n")})}else{const s=a.title||"unknown",l=w(e);if(!l.length)continue;const o=$(s)||"unknown",c=(n[o]||0)+1;n[o]=c;const i=c>1?`${o}_${c}.txt`:`${o}.txt`;t.push({filename:i,content:l.join("\n")})}}if(0===t.length)throw new Error("未找到有效的对话内容");return t}if("object"!==typeof e||Array.isArray(e))throw new Error("不支持的 JSON 格式");for(const n in e){const a=e[n];if(!a||"object"!==typeof a)continue;const s=a.mapping;if(!s)continue;const l=w(s);if(l.length){const e=$(n)||"unknown",a=l.join("\n");t.push({filename:e+".txt",content:a})}}if(0===t.length)throw new Error("未找到有效的对话内容");return t}function M(e){r.value=e,i.value=!0,d.value=null,m.value=!1,v.value=[]}function E(){i.value=!1,r.value=null,m.value=!1,v.value=[]}function W(){if(!l.value.trim())return o.value=n.value,void(f.value="");const e=l.value.toLowerCase();o.value=n.value.filter((t=>!!t.filename.toLowerCase().includes(e)||!!t.content.toLowerCase().includes(e))),f.value=l.value.trim()}async function R(e){const s=e.target.files[0];if(!s)return;t.value="正在解析文件...";const l=new FileReader;l.onload=function(e){try{const s=JSON.parse(e.target.result),l=S(s);if(n.value=l,o.value=l,a.value=l.map((()=>!1)),0===l.length)return void le.nk.error("解析完成，但未找到对话内容");t.value=`解析完成，找到 ${l.length} 个会话`}catch(s){le.nk.error(s.message||"解析失败"),t.value="解析失败"}},l.readAsText(s,"utf-8")}async function O(){if(a.value.some((e=>e)))try{t.value="正在准备导出...";const e=n.value.filter(((e,t)=>a.value[t]));if(1===e.length){const n=new Blob([e[0].content],{type:"text/plain"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=e[0].filename,s.click(),URL.revokeObjectURL(a),t.value="导出完成"}else{t.value="正在打包文件，请稍候...";const n=new(ae());e.forEach((e=>{n.file(e.filename,e.content)}));const a=await n.generateAsync({type:"blob"}),s=URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download="chatgpt_dialogues.zip",l.click(),URL.revokeObjectURL(s),t.value=`已导出 ${e.length} 个文件到 chatgpt_dialogues.zip`}}catch(e){t.value="导出失败"}}const T=(0,s.EW)((()=>{if(!r.value?.content)return[];const e=/【(model_message|user_message|assistant|user)】/,t=r.value.content.split("\n"),n=[];let a="",s="";for(const l of t){const t=l.match(e);t?(a&&n.push(`【${s}】${a}`),s=t[1],a=l.replace(e,"").trim()):s&&(a+="\n"+l)}return a&&n.push(`【${s}】${a}`),n.filter((e=>{const t=e.replace(/^【.*?】\s*/,"").trim();return t.length>0}))}));function A(e){return e.startsWith("【assistant】")||e.startsWith("【model_message】")?"message-left":"message-right"}function j(e){return e.startsWith("【assistant】")||e.startsWith("【model_message】")}function U(e,t){const n=e.match(/\[(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})\]/),a=n?n[1]:"";let s=e.replace(/^【.*?】\s*/,"").trim();s=s.replace(/\[\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\]\s*/,"");const l=e.startsWith("【user_message】")?s.replace(/-{20,}/g,""):s,o=l.replace(/['’＇]/g,"'").replace(/["＂]/g,'"');let c=(0,se.xI)(o,{breaks:!0});if(f.value){const e=new RegExp(f.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");let n=0;c=c.replace(e,(e=>{const a=`search-match-${t}-${n}`;return n++,`<mark data-match-idx="${n-1}" id="${a}">${e}</mark>`}))}return a&&(c=`<span class="timestamp">${a}</span>${c}`),c.replace(/\s+$/,"").replace(/\n$/,"")}const K=(0,s.EW)((()=>{if(!r.value?.content)return{totalTokens:0,assistantCount:0,userCount:0};const e=r.value.content.split("\n");let t=0,n=0,a=0,s="",l="";const o=e=>{e=e.replace(/https?:\/\/[^\s]+/g,""),e=e.replace(/\[\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\]/g,"");let t=0;const n=e.match(/[a-zA-Z]+|[0-9]+|[\u4e00-\u9fa5]|[^\s]/g)||[];for(const a of n)/[a-zA-Z]/.test(a)?t+=Math.ceil(a.length/4):/[0-9]/.test(a)?t+=Math.ceil(a.length/2):/[\u4e00-\u9fa5]/.test(a)?t+=1:(/[\s.,!?;:'"()\-–—…]/.test(a),t+=.5);return Math.round(t)};for(const c of e)c.startsWith("【assistant】")||c.startsWith("【model_message】")?(s&&l&&(t+=o(s),"assistant"===l?n++:a++),l="assistant",s=c.replace(/^【.*?】\s*/,"").trim()):c.startsWith("【user】")||c.startsWith("【user_message】")?(s&&l&&(t+=o(s),"assistant"===l?n++:a++),l="user",s=c.replace(/^【.*?】\s*/,"").trim()):l&&(s+="\n"+c);return s&&l&&(t+=o(s),"assistant"===l?n++:a++),{totalTokens:t,assistantCount:n,userCount:a}}));async function D(){if(r.value?.content){u.value=!0,d.value=null;try{const e=await ue(r.value.content);null!==e&&(d.value=e)}catch(e){console.error("Token calculation failed:",e),le.nk.error("计算token失败，请稍后重试")}finally{u.value=!1}}}function I(){m.value=!m.value,m.value?v.value=T.value.map((()=>!1)):v.value=[]}function X(){const e=!b.value;v.value=T.value.map((()=>e))}async function Q(){if(!r.value?.filename)return void le.nk.error("没有可导出的对话内容");const e=T.value.filter(((e,t)=>v.value[t]));if(0!==e.length)try{const t=e.join("\n"),n=new Blob([t],{type:"text/plain;charset=utf-8"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a;const l=r.value.filename.replace(/\.[^/.]+$/,"");s.download=`${l}_选中消息.txt`,s.click(),URL.revokeObjectURL(a),le.nk.success(`已导出 ${e.length} 条选中消息`)}catch(t){console.error("导出失败:",t),le.nk.error("导出失败，请稍后重试")}else le.nk.warning("请选择要导出的消息")}async function N(e){const s=e.target.files;if(!s||!s.length)return;let l=[];for(const t of s)try{const e=await t.text();if(!e.trim()){le.nk.error(`${t.name} 文件内容为空`);continue}const n=e.split("\n"),a=n.some((e=>{const t=e.trim();return t&&!t.startsWith("-".repeat(20))}));if(!a){le.nk.error(`${t.name} 未包含有效的对话内容`);continue}const s=n.some((e=>{const t=e.trim();return t&&(t.startsWith("【assistant】")||t.startsWith("【user】")||t.startsWith("【model_message】")||t.startsWith("【user_message】"))}));if(!s){le.nk.error(`${t.name} 未包含有效的AI或用户对话内容`);continue}l.push({filename:t.name,content:e})}catch(c){le.nk.error(`读取${t.name}失败`)}l.length&&(n.value=[...n.value,...l],o.value=n.value,a.value=n.value.map((()=>!1)),t.value=`已导入 ${l.length} 个txt文件`),e.target.value=""}function P(){(0,s.dY)((()=>{h.value=Array.from(document.querySelectorAll(".modal-body mark[data-match-idx]")),g.value=h.value.length,g.value>0&&V(p.value)}))}function V(e){h.value[e]&&(h.value[e].scrollIntoView({behavior:"smooth",block:"center"}),h.value.forEach(((t,n)=>{t.classList.toggle("active-match",n===e)})))}function z(){g.value<=1||(p.value=(p.value-1+g.value)%g.value,V(p.value))}function H(){g.value<=1||(p.value=(p.value+1)%g.value,V(p.value))}return(0,s.sV)((async()=>{document.title="💬 对话记录解析器",await(0,s.dY)(),setTimeout((async()=>{try{await re()}catch(e){console.error("Failed to preload encoder:",e),le.nk.error("加载失败，请刷新页面重试")}}),100)})),(0,s.wB)([i,f,r],(()=>{i.value&&(p.value=0,P())})),{outputContent:e,status:t,canDownload:c,lastOutputs:n,selectedFiles:a,isAllSelected:k,showModal:i,currentFile:r,searchQuery:l,filteredOutputs:o,statistics:K,handleFileChange:R,handleDownload:O,showFileContent:M,closeModal:E,toggleSelectAll:L,updateSelection:C,chatLines:T,getMessageClass:A,isLeftMessage:j,getMessageContent:U,handleSearch:W,isCalculating:u,exactTokens:d,calculateExactTokens:D,handleTxtFileChange:N,searchKeyword:f,matchCount:g,currentMatchIndex:p,gotoPrevMatch:z,gotoNextMatch:H,toggleSelectMode:I,toggleSelectAllMessages:X,exportSelectedMessages:Q,selectedMessages:v,isSelectMode:m,isAllMessagesSelected:b,hasSelectedMessages:_,selectedMessagesCount:y}}},fe=n(6262);const ge=(0,fe.A)(de,[["render",ee],["__scopeId","data-v-797740c9"]]);var pe=ge,he=n(2220);n(4188);const ve=(0,a.Ef)(pe);ve.use(he.A),ve.mount("#app")}},t={};function n(a){var s=t[a];if(void 0!==s)return s.exports;var l=t[a]={exports:{}};return e[a].call(l.exports,l,l.exports,n),l.exports}n.m=e,function(){var e=[];n.O=function(t,a,s,l){if(!a){var o=1/0;for(u=0;u<e.length;u++){a=e[u][0],s=e[u][1],l=e[u][2];for(var c=!0,i=0;i<a.length;i++)(!1&l||o>=l)&&Object.keys(n.O).every((function(e){return n.O[e](a[i])}))?a.splice(i--,1):(c=!1,l<o&&(o=l));if(c){e.splice(u--,1);var r=s();void 0!==r&&(t=r)}}return t}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[a,s,l]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var s,l,o=a[0],c=a[1],i=a[2],r=0;if(o.some((function(t){return 0!==e[t]}))){for(s in c)n.o(c,s)&&(n.m[s]=c[s]);if(i)var u=i(n)}for(t&&t(a);r<o.length;r++)l=o[r],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(u)},a=self["webpackChunkchatlog_parser"]=self["webpackChunkchatlog_parser"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[504],(function(){return n(2706)}));a=n.O(a)})();
//# sourceMappingURL=app.4f8bec94.js.map